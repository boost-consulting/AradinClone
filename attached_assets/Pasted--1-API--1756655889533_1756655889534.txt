優先度1（ブロッカーの解消＝まず“通す”）

履歴テーブルの外部キー違反を確実に潰す

すべての“書き込み系API”（出荷確定／受入／棚入れ／販売／顧客返品／店舗→倉庫返品送付／返品受入・検品／在庫確保）は、**実行ユーザーID（performed_by_users_id）**を必須で受け取り、存在するユーザーだけを許可する。

ヘッダーの「現在ユーザー種別／店舗選択」を必ずAPIのペイロードに同梱する。未指定だった場合はsystemユーザーにフォールバックしてもよい。

デモ用ユーザーを初期シード：admin、warehouse_user、store_user_1..6。既存履歴の不整合はsystemに置換して一括整合。

ダッシュボードの遷移とクイックアクションを有効化

上段4カードはクリックで遷移（未処理出荷指示→入出庫/出荷処理、受入→入出庫/受入、在庫少数→出荷指示、販売→販売管理）。

下段「クイックアクション」はリンクを確実にバインド（入出庫／販売管理／出荷指示／返品管理）。

セレクト/フィルタの初期値・空状態を厳密化

すべてのセレクトは空文字の値を使わない（初期値は "all" などの非空文字）。

すべての表・カード・リストに空状態の文言を実装。「該当データがありません」。

KPIは0安全表示（null/undefinedでNaNにならない）。

優先度2（“数字が動く”最小運用）

初期ダミーデータのシードを実行可能にする

起動時 or 管理画面「サンプルデータ作成」ボタンのどちらかで投入。内容は以下固定：

商品：12型×色2×サイズ3＝72SKU。

場所：倉庫（棚A/B/C）、店舗1〜6。

補充基準（SKU×場所）：店舗=下限2/基準5/標準補充量5、倉庫=下限5/基準15/標準補充量20。

在庫残高：倉庫はSKUごと計20（A10/B6/C4：主に「通常」）、店舗は0〜5（主に「通常」、一部「不良」）。

出荷指示：店舗1に3件、店舗2に2件（受付中）。

履歴：受入→棚入れ2、販売3、顧客返品1、店舗→倉庫返品送付1、返品受入+検品1、在庫確保1。

ユーザー：上記8アカウント。

目的：ダッシュボード／在庫一覧／入出庫／販売管理／出荷指示／返品管理がすべて“それっぽく”埋まること。

ダッシュボードの数値・一覧を実集計に接続

上段4カード：未処理出荷指示件数／本日の受入（予定・処理）／下限割れSKU件数／直近7日販売点数をDBから集計。

下段2表：未処理の出荷指示一覧／少数アラート詳細をDBから取得。

ページ再表示で最新。必要ならこの2枠のみ10–15秒間隔で再取得。

右サイド「直近の履歴」をページごとに切替

取得キーとクエリをページ別に可変にする（ルート/タブに連動）。

入出庫＝受入/棚入れ/確保/出荷、出荷指示＝作成/完了、販売管理＝販売/顧客返品、返品管理＝返品送付/返品受入/返品検品。

ルーティング変更で確実に再取得されること。

優先度3（各画面の“通し”を完成）

在庫一覧—「明細」モーダルを接続

クリックで SKU×場所に絞った履歴（最新20件）をモーダル表示。操作種別／数量±／日時／担当／元→先場所を示す。

入出庫—出荷処理・受入・返品検品を通す

出荷処理：未処理一覧→詳細→在庫確保（任意）→出荷確定。

出荷確定で倉庫（通常 or 確保）↓／店舗（通常）↑／指示=完了／履歴追記。在庫不足は具体的エラーメッセージ。

仕入受入・棚入れ：受入で検品中↑→棚入れ確定で良品は通常↑／不良は不良↑。

返品受入・検品：店舗→倉庫返品到着で検品中↑→検品確定で通常↑ or 不良↑。

販売管理—在庫サマリとSKU選択を活性化

ヘッダーの店舗セレクタを対象店舗IDとして必ず使用。

在庫サマリは対象店舗の通常／不良を表示。

SKU選択は商品一覧から供給（在庫ありのみに絞るのは任意）。

登録後は当ページに戻して在庫↓／販売履歴に金額が出る。

出荷指示—一覧・作成・アラート連携

左：少数アラート（自店舗）。SKUクリックで**SKUと推奨数量（基準−現在庫、負は0）**をフォームにプリセット。

中：未処理の出荷指示（受付中）。

右：完了済み出荷指示（最近20件）。

「出荷指示を作成」で保存→当ページに戻り、未処理が増えること。

返品管理—登録を通す

顧客返品：再販可→店舗の通常↑／不良→店舗の不良↑。

倉庫返品送付：店舗の通常↓、入出庫の「返品受入・検品」にタスクが現れる。

優先度4（通知・一貫性・用語）

通知バッジの中身を実装

バッジの数＝未処理の出荷指示件数。クリックでドロップダウンに未処理一覧→行クリックで入出庫（出荷処理）へ。

未件時は「未処理の出荷指示はありません」。

店舗選択の一貫性

ヘッダーの店舗選択を販売管理／出荷指示／返品管理に反映。店舗ロール時は固定。

用語・履歴種別を統一

UIとDBのイベント名を同一語で統一（例：「棚入れ」）。色分け・アイコンも種別に連動。

優先度5（整合性ルールの徹底）

在庫更新＝一体処理＋履歴1行（全APIで同じ作法）

出荷確定：倉庫（通常 or 確保）−／店舗（通常）＋／指示=完了／履歴追記。

受入→棚入れ：検品中＋ → 確定で通常＋ or 不良＋。

顧客返品：再販可→店舗通常＋／不良→店舗不良＋。

店舗→倉庫返品送付：店舗通常− → 倉庫検品中＋。

確保：倉庫通常− → 確保＋（運用しない場合も挙動は一定）。

受け入れ確認（この順で検証）

出荷指示を作成 → ダッシュボードと入出庫の未処理一覧に増える。

入出庫で出荷確定 → 倉庫↓・店舗↑・指示=完了・履歴に記録。

販売登録 → 店舗の通常↓・販売金額の履歴。

顧客返品（再販可） → 店舗の通常↑（不良なら店舗の不良↑）。

店舗→倉庫返品送付 → 入出庫の「返品受入・検品」に表示→検品確定で倉庫の通常 or 不良へ。

受入→棚入れ確定 → 倉庫の検品中→通常/不良に反映。

在庫一覧「明細」モーダルで、対象SKU×場所の履歴が表示される。